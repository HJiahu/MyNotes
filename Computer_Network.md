本文摘自：Computer Networking 

### 第一、二章 简介和应用层
一些关键字：
-	URL： Uniform Resource Locator
-	viral marketing ：病毒行销，可以自我行销的产品称为病毒行销。邮件就是病毒行销的典型例子。             （先行者优势）
-	分组嗅探器 ：packet sniffer

网络程序有两类：
-	一类为网络应用程序，它们由RFC所定义的标准协议实现。
-	另一类为专用的网络程序。注：开发一个网络应用程序不能使用RFC中已被使用了的周知端口号。                       

网络的分层结构：
-	应用层：
	-	应用层协议：DNS（53）、HTTP（80） 、SMTP（25）、FTP（20  21 ） ... ***应用层协议主要关注的是数据的内容（如数据的格式），和数据的传输没有关系。***
	-	应用层数据：报文（message）
	-	应用层性能：可靠数据传输（可以利用TCP）、吞吐量、定时、安全性（SSL：  secure socket layer）
-	传输层：
	-	传输层协议：TCP（面向链接）、UDP（面向报文）   ***从这一层就开始讨论数据的传输问题，进程之间的逻辑链路。***
	-	传输层数据：报文段（segment）
-	网络层：
	-	网络层协议：IP   （***主机之间的逻辑链路，这些主机不一定直接相连***）
	-	网络层数据：数据报（datagram）
-	数据链路层（***两台直接连接的主机之间的通信***）：
	-	数据链路层数据：帧  这个时候主要讲电信号和光信号  不再是比较抽象的东西。
-	物理层：
	-	主要讲硬件，和信号已经没有多少关系。
	-	HFC:Hybrid Fiber－Coaxial：混合光纤同轴电缆网。是一种经济实用的综合数字服务宽带网接入技术 。HFC通常由光纤干线、同轴电缆支线和用户配线网络三部分组成，从有线电视台出来的节目信号先变成光信号在干线上传输；到用户区域后把光信号转换成电信号，经分配器分配后通过同轴电缆送到用户
 
TCP：Transmission Control Protocol 
> 面向连接的，可靠的数据传输。先握手再通信。拥有拥塞控制机制，这对实时数据传输是不利的。故实时应用可选用UDP，但很多防火墙被配置为阻塞UDP流量，故应以不同的情况选取不同的运输层协议。

UDP：User Datagram Protocol
> 面向报文。仅提供最小服务。UDP是无连接的，相对于TCP而言没有握手过程，是不可靠的数据连接。

SSL：（secure socket layer） 
>处于TCP与UDP之上，为TCP与UDP提供加密机制。SSL并未对TCP与UDP产生影响。两个进程之间通信一般需要两个地址，一个为目的主机的IP地址，二是目的进程的端口号。（开发一个新的网络应用程序，必须为其分配一个新的端口号。）

流量强度：
>接收比特的速率和传输比特的速率之比，流量强度不能大于  1 。

***应用层协议HTTP***
-	端口号：80 ＴＣＰ连接           

***web：***
-	web使用应用层协议HTTP（端口号：80，使用的传输层协议为TCP），web由多个对象组成，一般若web包含html文本和5个图片，则这个web有6（1+5）个对象。每个对象通过对应的URL进行引用。
-	HTTP服务器并不保存关于客户机的任何信息，故称HTTP为无状态协议。即使客户端在很短的时间内对同一对象进行请求，服务器也会进行反应。

-	非持久连接：
> web每个对象的请求均建立一个独立的TCP，但这些TCP可并行建立从而加快了响应速度。

-	持久连接：
> 对于同一客户机与服务器之间只建立一条TCP，所有对象由TCP传输。

***cookie***                    
-	虽说HTTP是无状态的，但可以使用cookie使服务器跟踪用户的动作。cookie系统由四个部分组成：
1. HTTP响应报文中有一个cookie首部行。
2. HTTP请求报文中有一个cookie首部行。
3. 用户系统中有一个cookie文件。
4. 在web站点有一个关于cookie的后端数据库。
-	cookie标识码由服务器产生，并用于服务器对端系统的身份识别，web系统可以使用cookie（设识别码为12345）记录用户12345（系统不知道用户的真实姓名）的行为，并通过这些数据对用户做出一些反应，例如对用户推荐一些产品。若将cookie识别码与用户的用户名和密码对应，则用户在下次登录系统是可以不用输入用户名和密码。
-	cookie的一个争议就是使用cookie可能会侵犯用户的隐私。

web缓存器（web cache）也称为web代理器（proxy  server）：
-	web  cache即使客户机也是服务器，当浏览器向web缓存发出请求时，web缓存为服务器，当web缓存向源web服务器请求数据时（缓存中缺少某些对象）其又是客户机。
-	web  cache可以是一台主机由ISP提供，也可以是本PC机上的一个通用的软件。
-	web  cache存在与源web  sever 同步的问题，一般web缓存会在一定的时间里与源web server同步，同步时使用的是条件GET指令。

***FTP***
-	端口号：21  (File Transfer Protocol)
-	FTP与HTTP均是建立在TCP连接上的，但ＦＴＰ存在两类TCP连接，一类为控制连接，一类为数据连接。其中控制连接是持久连接，数据连接是非持久连接。
-	ＦＴＰ被称为带外（out-of-band）传输，因为FTP的控制信号传输由一条单一的TCP传输，与数据传输不是一条TCP。HTTP被称为带内（in-band）传输，虽说HTTP的对象传输使用不同的TCP，但控制信号在每个TCP中传输，即控制信号和数据信号在相同的TCP中传输。
-	FTP在整个会话中会通过控制连接保留用户的状态和行为，而HTTP不会保留用户的状态。

应用层协议SMTP（端口号：25 TCP） Mail      （simple mail transfer protocol ）
应用层协议p2p。

***DNS***（domain name system ）：
-	DNS为应用层协议的原因：
	-	使用客户机/服务器的模式在通信的终端运行。
	-	在端系统之间通过下面的端到端运输层协议传送ＤＮＳ报文。
-	ＤＮＳ系统的组成：
	-	一个分层的ＤＮＳ　server 实现的分布式数据库。
	-	一个允许主机查询分布式数据库的应用层协议。
-	DNS服务器通常是运行着BIND（berkeley internet name domain）软件的unix服务器。
-	***ＤＮＳ运行在UDP上，且为其他应用层协议所使用（如HTTP 、FTP、SMTP）。***
-	用浏览器描述ＤＮＳ工作过程：
	-	同一台主机运行着ＤＮＳ应用的客户端。
	-	浏览器将域名传输给ＤＮＳ应用的客户端。
	-	ＤＮＳ客户机端向ＤＮＳ服务器发送一个包含主机名的ＤＮＳ请求。
	-	ＤＮＳ服务器返回一个（或一个集合）对应的主机ＩＰ地址。
	-	ＨＴＴＰ通过返回的ＩＰ与对应主机建立ＴＣＰ连接。
-	ＤＮＳ的其他功能：
	-	主机别名（host aliasing）：主机由唯一的规范主机名（和一个与之对应的ＩＰ集），但可能有多个与之对应的简单的易于记忆的别名，DNS将其转化为规范主机名，从而可以获得对应的IP。
	-	邮件服务器别名。
	-	负载分配：同一域名下可能有不同的主机，位于不同的地理位置，有不同的IP地址。DNS返回IP地址是很多时候返回的是IP集合。DNS可以通过改变IP集合中IP的顺序从而改变不同服务器的负载（因为应用程序一般选择IP集合前面的IP）。
-	DNS系统的实现：
	-	单DNS服务器：
        > 缺点：单点故障。通信容量巨大（traffic volume）远距离集中式数据库。维护困难。              

-	分布式层次数据库结构：
> 第一层：13个DNS根服务器；                  
> 第二层：顶级域名服务器（TLD），如.com  .org  .cn  .xyz                  
> 第三层：DNS服务器/权威dns服务器，如google.com                
> 本地dns服务器一般不属于dns系统，本地dns服务器只是相当于一种缓存。             

-	***权威域名服务器：每一个在internet中的有公共可访问主机的组织或机构，必须提供公共可访问的DNS记录，并将之存放在权威DNS服务器中。*** 权威DNS服务器可以是本组织的服务器也可以租用其他组织的服务器。权威DNS服务器位于DNS系统的底层，可以返回对应主机的IP。
-	权威DNS存在的理由：每一个机构都有很多的主机，这些主机可能位于不同的地理位置，有不同的IP地址，但他们可能有相同的域名，如果这些信息全部由顶级域名服务器进行管理，工作量太大。

-	DNS的查询可以使用递归形式和迭代查询：
	-	递归查询：每次查询都使用相同的步骤，但这些步骤是串行的，即只有下一步的操作完成，上一步的操作才能执行。
	-	迭代查询：每次查询都使用相同的步骤，但每次查询之间没有什么联系，某一步的查询是否完成对其他的查询没有影响。
-	DNS记录(resource   record 简称RR)的格式：（name   value   type     TTL ）
-	TTL（time to live ）用于记录本地记录的生存时间，当TTL大于一个值时，记录会被删除。
-	DNS记录的四种形式：
	-	（name      value      A     TTL）：value为主机名name对应的IP
	-	（name      value      NS    TTL）：value为主机name所属的权威DNS服务器的主机名（不是IP地址）。很多机构的权威DNS服务器是租赁的。
	-	（name      value      CNME  TTL）：value为主机别名为name的规范主机名。
	-	（name      value      MX    TTL）：value 为主机别名为name的主机的邮件服务器的规范主机名。
-	相同的别名但当请求不同的DNS记录时会获得不同的DNS记录，可能是主机的规范主机名或邮件服务器的规范主机名。
-	DNS服务只有两种报文，分别为查询报文和回答报文，且二者的报文格式是相同的。回答报文可能有多个，因为同一个域名可能有多个IP。
-	注册一个全新的域名最少要向对应的TLD注入A型与NS型两种记录。
-	如果一台DNS服务器是某个主机的权威DNS服务器其中含有一个A型记录。
-	如果一台DNS服务器不是某个主机的权威DNS服务器，则其中含有两条记录：NS型记录，记录对应主机所属的权威DNS服务器的主机名。A型记录，权威DNS服务器的IP。
-	大部分的DNS洪泛攻击可以由本地DNS缓存缓解。
-	中间人攻击：
> 中间人攻击（Man-in-the-MiddleAttack，简称“MITM攻击”）是一种“间接”的入侵攻击。这种攻击模式是通过各种技术手段将受入侵者控制的一台计算机虚拟放置在网络连接中的两台通信终端之间，这台计算机就称为“中间人”。

### 套接字编程简介
***TCP套接字编程***                
套接字编程一定分别存在存在客户端和服务器端进程，在TCP套接字编程中必然要先建立一个TCP链接，那么就需要两种套接字：
-	用来创建新TCP连接的套接字。用于与服务器相连接，服务器一定存在一个监听进程，客户端进程一定要先与监听进程进行通信。
-	创建完成之后的新套接字。与服务器连接之后，由监听进程通知服务器端，再建立一个进程来与客户端交互，监听进程继续监听其他请求。
-	客户端套接字最少需要服务器地址和端口号这两个参数，而服务器端的欢迎套接字一般就只有一个端口号。
-	可以同时使用ip和端口号来区分数据源，即使端口号相同，来自不同主机的数据的ip也是不同的。

***UDP套接字编程***                  
> udp套接字编程和TCP的区别是udp不需要建立tcp通信管道。故每次发送时都要提高服务器的地址和端口号。

***UDP套接字和TCP套接字的一些区别***
> TCP是面向连接的，故其套接字中有四元数据组用来保存目的地IP、目的地端口号、源ip、源端口号，这些数据用来确定数据的来源。            
> UDP是面向报文的，它只是尽最大可能传输数据，故在UDP报文中只使用一个两元的数据组用来区别数据的来源。      
> 从应用的角度，对于tcp而言，只有四元组中的所有数据都匹配，这个报文才会定向到对应的套接字，以确定数据是来自同一个管道。然而UDP不是这样，只要目的端口和目的ip匹配，数据就会被重定向对应的套接字，无论数据的来源ip是否相同。


### 第三章 运输层
运输层（传输的数据是 运输层报文）：
> 运输层为运行在不同主机上的应用程序提供逻辑通信（网络层提供主机之间的逻辑通信，运输层有软件的端口信息）。运输层是在端系统中实现的，只工作在端系统，不在网络路由器中实现。

运输层的工作方式：
> 运输层扫描获得的运输层报文，从中获取相关信息，不同的运输层报文会被重新定向到不同的进程的套接字，这个过程称为***多路分解***，而反过程称为***多路复用***。一般在运输层报文段中有目的端口号和源端口号。

一般的进程是不能使用周知端口号（0~1023）的，端口号是一个16字节的数据。

***UDP报文结构***          
报文尾部...报文数据 | 校验和 | 长度 | 目的端口号 | 源端口号（报文首部）           

***TCP***        
-	TCP 连接是点对点的，而且是全双工的。
-	TCO的三次握手（这三次都是***特殊的报文段***，前两个报文没有进行数据的传输，只是进行了一些交流）
	-	客户端向服务器发出请求（我想建立一条TCP）
	-	服务器对客户端进行回复（我已经准备好了，或者没准备好）
	-	客户端再次发送一个***特殊的报文***，这个报文可以包含部分的数据。
-	MTU  maximum Transmission unit 

***很多关于运输层的知识与细节问题在这里没有记录。***

### 第十章 网络层
-	网络层提供单一的尽力而为的服务。
-	每一台路由器都有一个  ***转发表***
-	最长前缀匹配规则：
> 假设ip数据报的首地址有32位，有4亿台主机。那么当一台主机向另一台发送消息时，如果不做特殊处理，则每一个路由器都要维护一个有4亿条记录的转发表，这个量太大了，很难实现。             
> 假设路由器有四个向外转发的接口，每个接口连接在不同的地址空间端，那么拿ip报首地址的前几位与这些端口的段范围进行匹配，将数据用匹配到的端口向外发送。     
> 这种方法叫 ~           


